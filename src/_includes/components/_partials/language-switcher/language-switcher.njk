{% from "components/_partials/icon/icon.njk" import icon %}

{#
  Language Switcher Component

  A dropdown-based language selector with URL-based navigation.
  Uses explicit alternate URLs from frontmatter (seo.alternate) when available,
  otherwise falls back to path-based URL construction.

  Languages are configured in lib/data/languages.json

  Parameters (optional overrides):
    languages - Array of language objects (defaults to data.languages.available)
    defaultLang - Default language code (defaults to data.languages.defaultLang)
    fallbackUrl - URL to navigate to if localized page doesn't exist
    alternateUrls - Object mapping language codes to URLs (from seo.alternate)
#}

{% macro languageSwitcher(languages, defaultLang, fallbackUrl, alternateUrls) %}
  {% set langs = languages or data.languages.available %}
  {% set default = defaultLang or data.languages.defaultLang %}
  {% set fallback = fallbackUrl or data.languages.fallbackUrl or '/404/' %}
  {% set alternates = alternateUrls or {} %}

  <div class="language-switcher js-language-switcher"
       data-default-lang="{{ default }}"
       data-fallback-url="{{ fallback }}"
       data-alternate-urls='{{ alternates | dump }}'>
    {{ icon({ url: "#", icon: "globe" }) }}
    <span class="current-lang js-current-lang">{{ default | upper }}</span>

    <ul class="language-dropdown js-language-dropdown" role="listbox" aria-label="Available languages">
      {% for lang in langs %}
        {% set langUrl = alternates[lang.code] if alternates[lang.code] else '' %}
        <li role="option" data-lang="{{ lang.code }}" data-url="{{ langUrl }}"{% if lang.code == default %} aria-selected="true"{% endif %}>
          <a href="{{ langUrl if langUrl else fallback }}" class="language-option js-language-option">
            <span class="lang-code">{{ lang.code | upper }}</span>
            <span class="lang-label">{{ lang.label }}</span>
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
{% endmacro %}
